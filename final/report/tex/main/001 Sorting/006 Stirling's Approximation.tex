\section{Stirling's Approximation}
\label{tree:sorting:stirling}

Later on in \Cref{tree:supi} we will be interested in counting elements
contained in some
finite set. By counting we mean for an infinite collection of finite sets
$\S_n$, where $n$ ranges over some index set $\I$ (\eg $\I = \N$), finding a
counting function $f(n)$ that is valid for all $\S_n$. In general we only
use the most satisfactory such formula. By \emph{most satisfactory} we mean a
completely explicit closed formula involving only well-known functions, and
free from summation (and product) symbols. Unfortunately, only in rare cases
will such a formula exist, and the more complicated the expression of $f(n)$
becomes the less we are willing to accept it as a determination
(see \citet*{Stanley:2011:ECV:2124415}, first chapter).

If we take the example of counting \emph{the number of ways a pile of books can
be rearranged}, \ie by permutation of the relative places of books, we can
conclude that for $\S_n$ being the set of all piles containing the same $n$
books we could manage to build by rearranging these $n$ books,
\begin{displaymath}
f(n) = n \cdot (n-1) \cdot (n-2) \cdots 3 \cdot 2 \cdot 1 = \prod_{k=1}^n k = n!
\end{displaymath}
is an exact formula. However this formula contains a product over the range
$[1, n]$ meaning that the computation of the value $f(n)$ would require $n$
multiplications. In fact this is what we wanted to avoid when we said that
there should not be such symbols in the most satisfactory formula.

So, is there a better way? Not always. Considering the general case, only a few
rare counting functions admit a formula that satisfies us. But, for
the example we gave, there is:
\begin{theorem}[Stirling's approximation 1730]
\label{tree:sorting:theorem/stirling}
\begin{align*}
n! &\simeq \sqrt{2 \pi n} \left(\frac{n}{e}\right)^n.
\end{align*}
\end{theorem}
Where \(\simeq\) means that the ratio of the two sides tends to \(1\) as \(n\)
tends to infinity.
This satisfactory\footnote{We consider this formula satisfactory even though it is
an approximation. Since we are interested in studying asymptotical complexity
of problems and algorithms it does not matter.} formula is known as Stirling's approximation. Details
about the proof can be found in \citet*{feller1967direct}.

\ref{tree:sorting:theorem/stirling} gives rise to several corollaries from
which we retain two.
\begin{corollary}
\begin{align*}
\ln n! &= n \ln n - n + \BigO{\ln n}\\
\end{align*}
\end{corollary}
\begin{corollary}
\label{tree:sorting:corollary/stirling}
\begin{align*}
\log n! &= \BigTheta{n \log n}\\
\end{align*}
\end{corollary}
For example, \ref{tree:sorting:corollary/stirling} is particularly useful
for the analysis of the asymptotic complexity of sorting and merging algorithms, because
of the way these problems are optimally tackled (divide and conquer).

Note that another way of looking at \ref{tree:sorting:corollary/stirling} is
saying that for some constant $c \in \R, c > 0$ and for some $N \in \R, N > 0$,
\begin{displaymath}
c \cdot n \log n \leq \log(n!) \leq n \log n, \Forall n \geq N.
\end{displaymath}

